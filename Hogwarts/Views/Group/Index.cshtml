
@{
    ViewBag.Title = "グループ管理";
    var nowLecture = ViewBag.NowLecture as Hogwarts.Models.Lecture;
    var myGroup = ViewBag.MyGroup as Hogwarts.Models.Group;
}

@Styles.Render("~/Content/jqueryui")
@Styles.Render("~/Content/layout")
@Scripts.Render("~/bundles/jqueryui")
@Scripts.Render("~/bundles/layout")

<style>
    .selected-hight {
        background-color: #FECA40;
        color: #000000;
    }

    .nonselected-hight {
        background-color: #0e90d2;
        color: #ffffff;
    }
</style>

<div id="layout" style="height:90vh;">
    <div class="ui-layout-north">
        現在講義：　@(nowLecture.LectureName)　　所属グループ：　@(myGroup.GroupName)
    </div>
    <div class="ui-layout-west">
        @Html.ActionLink("グループ追加", "Edit", "Group", new { area = "" }, new { @class = "btn-ghost" })
        <div id="divGroupList">
            @Html.Action("GroupListView")
        </div>
    </div>
    <div class="ui-layout-center">
        メンバー進捗
        <input type="button" id="btnRefreshMemberProgress" class="btn-ghost RefreshGroupMemberProgress" value="更新"/>
        <div id="divGroupMemberProgress">
            @Html.Action("GroupMemberProgressView")
        </div>
    </div>
    <div class="ui-layout-east">
        グループ別進捗
        <input type="button" id="btnRefreshGroupProgress" class="btn-ghost RefreshGroupProgress" value="更新" />
        <div id="divGroupProgress">
            @Html.Action("GroupProgressView")
        </div>
    </div>
    @*<div class="ui-layout-south">South</div>*@
</div>

<script type="text/javascript">
    $(function () {
        $("#layout").layout();

        var selectedGroupId = @(myGroup.Id);
        if (selectedGroupId > 0) {
            $('#tr_group_' + selectedGroupId.toString()).addClass('selected-hight');
        }

        $('#tblGroup tr').dblclick(function () {
            var rows = $('table tbody tr');
            rows.removeClass('selected-hight');
            $(this).addClass('selected-hight');

            var id = $(this).attr('id');
            selectedGroupId = id.replace('tr_group_', '');
            ShowGroupmemberProgress(selectedGroupId);
        });

        $("#btnRefreshMemberProgress").on('click', function (event) {
            if (selectedGroupId >= 0) {
                ShowGroupmemberProgress(selectedGroupId);
            }
        });

        $("#btnRefreshGroupProgress").on('click', function (event) {
            ShowGroupProgress();
        });

        function ShowGroupmemberProgress(groupId) {
            var ajaxData = { groupId: groupId};
            var url = '@Url.Action("GroupMemberProgressView", "Group")';

            $.ajax({
                type: "POST",
                url: url,
                data: ajaxData,
                dataType: "html"
            }).done(function (response, textStatus, jqXHR) {
                $("#divGroupMemberProgress").empty();
                $('#divGroupMemberProgress').append(response);
            }).fail(function (jqXHR, textStatus, errorThrown) {
                alert(errorThrown);
            }).always(function (jqXHR, textStatus) {
            });
        };

        function ShowGroupProgress() {
            var url = '@Url.Action("GroupProgressView", "Group")';

            $.ajax({
                type: "POST",
                url: url,
                dataType: "html"
            }).done(function (response, textStatus, jqXHR) {
                $("#divGroupProgress").empty();
                $('#divGroupProgress').append(response);
            }).fail(function (jqXHR, textStatus, errorThrown) {
                alert(errorThrown);
            }).always(function (jqXHR, textStatus) {
            });
        }
    });
</script>

