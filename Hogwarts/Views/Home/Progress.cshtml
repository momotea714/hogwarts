@{
    @Scripts.Render("~/bundles/star-rating")
    @Styles.Render("~/Content/jqueryui")
    @Styles.Render("~/Content/accordion")
    @Scripts.Render("~/bundles/accordion")
    @Styles.Render("~/Content/star-rating")
    @Scripts.Render("~/bundles/jqueryui")

    var lectures = ViewBag.Lectures as IEnumerable<Hogwarts.Models.Lecture>;
    var subLectures = ViewBag.SubLectures as IEnumerable<Hogwarts.Models.SubLecture>;
    var questions = ViewBag.Questions as IEnumerable<Hogwarts.Models.Question>;
}

<style>
    body {
        font-family: Arial, Tahoma, Verdana, Helvetica, sans-serif;
    }

    .accordion-expand-holder .open, .accordion-expand-holder .close {
        margin: 0 10px 0 0;
    }

    .ui-accordion-content {
        height: auto;
    }
</style>

<h3>全体進捗</h3>
@foreach (var lecture in lectures)
{
    <div class="accordion">
        <h3>
            @lecture.LectureName
        </h3>
        <div>
            @foreach (var subLecture in subLectures.Where(x => x.LectureId == lecture.Id))
            {
                <div class="accordion">
                    <h3>
                        @subLecture.SubLectureName
                    </h3>
                    <div>
                        <table class="table table-hover table-striped">
                            <tr>
                                <th width="10%">
                                    問題
                                </th>
                                <th width="20%">
                                    難易度
                                </th>
                                <th width="10%">
                                    未完了
                                </th>
                                <th width="10%">
                                    仕掛中
                                </th>
                                <th width="10%">
                                    完了
                                </th>
                                <th width="20%">
                                    進捗率
                                </th>
                                <th width="20%">
                                    理解度
                                </th>
                            </tr>
                            <tbody>
                                @foreach (var question in questions.Where(x => x.SubLectureId == subLecture.Id))
                                {

                                <tr>
                                    <td>
                                        @question.QuestionName
                                    </td>
                                    <td>
                                        <input type="text" class="rating" value="2" data-size="xs" title="" data-readonly="true" data-show-clear="false" data-show-caption="false">
                                    </td>
                                    <td>3人</td>
                                    <td>50人</td>
                                    <td>47人</td>
                                    <td>
                                        <div id="sldProgress_question_@(question.Id.ToString())" class="slider_progress">
                                            <div class="ui-slider-handle"></div>
                                        </div>
                                        <label id="lblProgress_question_@(question.Id.ToString())"></label>
                                    </td>
                                    <td>
                                        <div id="sldUnderStand_question_@(question.Id.ToString())" class="slider_understand">
                                            <div class="ui-slider-handle"></div>
                                        </div>
                                        <label id="lblUnderStand_question_@(question.Id.ToString())"></label>
                                    </td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }
        </div>
    </div>
}


<script type="text/javascript">
    $(function () {
        var icons = {
            header: "ui-icon-circle-arrow-e",
            activeHeader: "ui-icon-circle-arrow-s"
        };
        $(".accordion").accordion({
            collapsible: true,
            active: false,
            heightStyle: "content",
            icons: icons,
        });

        var slider_progress = $(".slider_progress");
        var slider_understand = $(".slider_understand");
        slider_progress.each(function () {
            SetSlider($(this));
        });

        slider_understand.each(function () {
            SetSlider($(this));
        });

        function SetSlider(sliderObj) {
            sliderObj.empty().slider({
                value: 0,
                min: 0,
                max: 100,
                range: "max",
                step: 10,
                animate: 100,
                slide: function (event, ui) {
                    sliderObj.siblings().text(ui.value);
                    var id = sliderObj[0].id.replace("sld", "lbl");
                    $('#' + id).text(ui.value.toString() + "%")
                }
            });
        }
    });
</script>
